---
title: 领域驱动设计统一过程
date: 2024-05-05 20:28:39
top_img: /img/cover/mybatis.jpeg
cover: /img/cover/mybatis.jpeg
tags: [DDDUP, 领域驱动设计统一过程, 笔记]
---

# 《解构领域驱动设计》阅读
软件复杂度挑战：
1. 规模——以子领域、限界上下文对问题空间与解空间分而治之
2. 结构——以分层架构隔离业务复杂度与技术复杂度，形成清晰的架构
3. 变化——通过领域建模抽象为以聚合为核心的领域模型，响应需求的变化

**领域驱动设计统一过程**（**Domain-Driven Desigh Unified Process**, **DDDUP**）分为三个阶段：
+ 全局分析阶段
+ 架构映射阶段
+ 领域建模阶段

## 开篇
### 1. 软件复杂性
**复杂系统**：由大量相互作用的部分组成的系统。与整个系统比起来，这些组成部分相对简单，没有中央控制，组成部分之间也没有全局性的通信，并且组成部分的相互作用导致了复杂行为。

软件系统的复杂性同时体现在**理解能力**上的复杂难解（complicated），和**预测能力**上的复杂难测（complex）。

+ 理解能力的影响因素：
    + 规模：主要由软件需求决定，需求的数量及其内在关系
    + 结构：由系统的质量属性决定，UPRS等非功能性需求
        + 细节层面，代码污浊不堪，违背了“高内聚低耦合”的设计原则
        + 架构层面，缺乏清洗的边界，各种通信与调用依赖纠缠在一起
+ 预测能力的影响因素：
    + 变化：在架构设计时期，如何准确预测变化发生的可能性，从而作出相应的设计以作应对
        + 过度设计：过度抽象，增加了方案的复杂度，但预期的变化并没有发生
        + 设计不足：没有识别出可能会发生的变化，导致方案缺乏可扩展性，后期修改成本过高

### 2， 领域驱动设计概览
#### 2.1 基本概念
**领域驱动设计元模型**的要素关系如图所示
<center>
    <img style="border-radius: 0.3125em;
        box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
        src="/img/ddd/ddd_meta_model.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
        display: inline-block;
        color: #999;
        padding: 2px;">
        领域驱动设计元模型
    </div>
</center>

领域驱动设计的核心是**模型驱动设计**，而模型驱动设计的核心是**领域模型**，领域模型必须在**统一语言**的指导下获得。

领域模型分类：
+ 核心子领域
+ 通用子领域
+ 支撑子领域

引入**限界上下文**来确定业务能力的自治边界，通过**持续集成**来维护模型的统一

领域模型的设计要素：实体、值对象、领域服务、领域事件

聚合是一种边界，可以封装一到多个实体与值对象，并维持该边界范围内的业务完整性。聚合至少包含一个实体，且只有实体才能作为聚合根。

工厂（factory）和资源库（repository）负责管理聚合的生命周期。

#### 2.2 问题空间与解空间
软件系统的构建实则是对问题空间的求解，以获得构成解空间的设计方案

对客户提出的问题，需要分清楚什么是问题，什么事解决方案，即“问题级需求”与“方案级需求”的区别

“问题级需求”才是在问题空间理解客户需求，

对于问题空间，强调运用**统一语言**来描述需求问题，利用**核心子领域**、**通用子领域**与**支撑子领域**来分解问题空间

#### 2.3 战略设计与战术设计
+ 战略设计：
    + 问题空间：对问题空间进行合理分解，识别出核心子领域、通用子领域和支撑子领域，并确定各个子领域的目标、边界和建模策略。
    + 解空间：对问题空间进行解决方案的架构映射，通过划分限界上下文，为统一语言提供知识语境，并在其边界内维护领域模型的统一。
        每个限界上下文的内部有着自己的架构，限界上下文之间的协作关系则通过上下文映射来体现和表达。
+ 战术设计：如果选择了领域模型模式，此时要在限界上下文开展领域建模。在限界上下文内部，需要通过分层架构降临太过于独立出来，在排除技术实现的干扰下，通过与领域专家的协作在同一语言的指导下逐步获得领域模型。

从战略设计到战术设计是自顶向下，为**设计原则对设计决策的指导**；
将战术设计方案反馈给战略设计，是自底向上的演化过程，为**对领域概念的重构引起对战略架构的重构**。

#### 2.4 领域模型驱动设计
模型驱动设计是面向领域的，遵循两大原则:
1. **以领域为建模驱动力**：在建模过程中，针对领域知识提炼抽象的领域模型，并不断针对领域模型进行深化与突破，知道最终以代码来表达领域模型。
2. **排除技术因素的干扰**：领域建模与技术实现的关注点分离有助于保证领域模型的纯粹性，也能避免混淆领域概念和其他只与技术相关的概念。

#### 2.5 领域驱动设计过程
1. 面对客户需求，由领域专家与开发团队展开充分交流，经过需求分析与知识提炼，获得需求明确的**问题空间**。
2. 从问题空间的业务需求提炼统一语言，利用子领域分解问题空间，根据价值高低确定**核心子领域、通用子领域和支撑子领域**。
3. 通过对问题空间开展战略层次求解，获取**限界上下文**形成解空间的主要支撑元素。
    + 遵循“高内聚松耦合”的原则划分领域知识的边界，在通过**上下文映射**管理它们之间的关系
4. 通过**分层架构**将衔接上下文内部的领域隔离出来，进行面向领域的**模型驱动设计**（战术设计阶段）
5. 选定一个限界上下文，进行领域分析，提炼领域知识建立满足统一语言要求的领域分析模型，然后引入**实体、值对象、领域服务、领域事件、聚合、资源库和工厂**等设计要素开始程序设计，获得设计模型之后在其指导下进行编码实现，输出最终的领域模型、
<center>
    <img style="border-radius: 0.3125em;
        box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
        src="/img/ddd/ddd_process.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
        display: inline-block;
        color: #999;
        padding: 2px;">
        领域驱动设计过程
    </div>
</center>

#### 2.6 如何控制了软件复杂度
+ 控制规模：战略设计阶段，采用**限界上下文**和**上下文映射**分解问题空间，降低单个子领域的规模
+ 清晰结构：通过**分层架构**将领域分离出来，在业务逻辑（业务需求）与技术实现（质量需求）之间划定一条清晰的边界。
    + 业务需求之间的复杂关系也会导致系统结构混乱不堪
+ 响应变化：领域驱动设计通过**模型驱动设计**针对限界上下文进行领域建模，形成了结合分析、设计和实现于一体的领域模型。


### 3. 领域驱动设计统一过程
领域驱动设计的不足
1. **领域驱动设计缺乏规范的统一过程**：没有统一过程去规划战略设计和战术设计阶段需要执行的活动、交付的工作以及阶段里程碑。
2. **领域驱动设计缺乏与之匹配的需求分析方法**：
3. **领域驱动设计缺乏规范化的、具有指导意义的架构体系**：
4. **领域驱动设计的领域建模方法缺乏固化的指导方法**：

#### 3.1 统一过程的二维模型
参考了统一过程（rational unified process. RUP）
<center>
    <img style="border-radius: 0.3125em;
        box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
        src="/img/ddd/ddd_up.png">
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
        display: inline-block;
        color: #999;
        padding: 2px;">
        领域驱动设计统一过程
    </div>
</center>


#### 3.2 统一过程的动态结构
结合领域驱动设计对问题空间和解空间的阶段划分、对战略设计和战术设计的层次划分

过程工作流
+ 全局分析阶段：探索与分析问题空间，获得以业务服务为业务需求单元的**全局分析规格说明书**
    1. 价值需求分析：识别目标系统的利益相关者，明确系统愿景，识别系统范围。
    2. 业务需求分析：
        1. 根据用户发起的服务请求，梳理出提供**业务价值**的动态业务流程，体现
        了多个角色在不同阶段进行协作的执行序列。
        2. 根据业务流程的时间节点，在**业务目标**的指导下将业务流程划分为不同时间阶段的多个业务场景。
        3. 业务场景由多个角色参与，划分每个角色在该场景下与目标系统的一次功能交互，由此得到**业务服务**
        4. 根据价值需求分析结果，将不同的业务需求划分到不同的领域（核心、通用、支撑）
+ 架构映射阶段：从组织级、业务级和系统级3个层次完成对问题空间的求解，映射为遵循领域驱动架构风格的**架构映射战略方案**。
    + 组织级映射：根据价值需求，确定解空间的边界，通过系统上下文呈现利益相关者、目标系统与伴生系统的关系
    + 业务级映射：根据业务需求，对业务服务表达的业务知识进行归类与归纳，识别出边界相对合理的限界上下文。
        + 限界上下文内存遵**循菱形对称架构模式**；
        + 限界上下文之间通过不同的**上下文映射模式**表达协作方式，规范服务契约
    + 系统级映射：在划分好的子领域的指导下，在系统上下文的边界内部建立系统分层架构
        + 业务价值层：核心子领域的限界上下文的映射结果
        + 基础层：通用子领域和支撑子领域的限界上下文
        + 边缘层：为前端提供统一的网关入口
+ 领域建模阶段：对问题空间战术层次的求解过程，目标是**建立领域模型**
    + 领域分析建模：以领域专家为主导，针对限界上下文对应的领域开展分析建模，形成领域分析模型
        + 里程碑目标：业务服务规约和领域模型概念图
    + 领域设计建模：以开发团队为主导，围绕每个完整的业务服务开展设计工作，获得领域设计模型
        + 里程碑目标：以聚合为核心的静态设计类图和由角色构造型组成的动态序列图与序列图脚本
    + 领域实现建模：以开发团队为主导，在拆分业务服务为任务的基础上开展测试驱动开发，编写出领域相关的产品代码和单元测试代码，形成领域实现模型
        + 里程碑目标：实现业务功能的产品代码和验证业务功能的测试代码

#### 统一过程的静态结构
过程工作流与设计元模型

| 过程工作流 | 模式 | 方法 |
| --- | --- | --- |
| 价值需求分析 | 统一语言 | 商业模式画布 |
| 业务需求分析 | 统一语言、核心子领域、通用子领域、支撑子领域 | 业务流程图、服务蓝图、业务服务图、事件风暴 |
| 组织级映射 | 系统上下文 | 系统上下文图、业务序列图 |
| 业务级映射 | 限界上下文、上下文映射、菱形对称架构 | V型映射过程、事件风暴、服务序列图、康威定律、领域特性团队 |
| 系统级映射 | 核心子领域、通用子领域、支撑子领域、系统分层架构 | 康威定律 |
| 领域分析建模 | 统一语言、限界上下文、模型驱动设计 | 快速建模法、事件风暴 |
| 领域设计建模 | 统一语言、模型驱动设计、实体、值对象、聚合、领域服务、领域事件、资源库、工厂、事件溯源 | 角色构造型、服务驱动设计 |
| 领域实现建模 | 统一语言、模型驱动设计 | 测试驱动开发、简单设计、测试金字塔 |


## 全局分析阶段


## 架构映射阶段


## 领域建模阶段


## 融合

